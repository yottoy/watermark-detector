const O={"\0":{name:"NULL",category:"Control character"},"":{name:"START OF HEADING",category:"Control character"},"":{name:"START OF TEXT",category:"Control character"},"":{name:"END OF TEXT",category:"Control character"},"":{name:"END OF TRANSMISSION",category:"Control character"},"":{name:"ENQUIRY",category:"Control character"},"":{name:"ACKNOWLEDGE",category:"Control character"},"\x07":{name:"BELL",category:"Control character"},"\b":{name:"BACKSPACE",category:"Control character"},"	":{name:"CHARACTER TABULATION",category:"Control character"},"\n":{name:"LINE FEED",category:"Control character"},"\v":{name:"LINE TABULATION",category:"Control character"},"\f":{name:"FORM FEED",category:"Control character"},"\r":{name:"CARRIAGE RETURN",category:"Control character"},"":{name:"SHIFT OUT",category:"Control character"},"":{name:"SHIFT IN",category:"Control character"},"":{name:"DATA LINK ESCAPE",category:"Control character"},"":{name:"DEVICE CONTROL ONE",category:"Control character"},"":{name:"DEVICE CONTROL TWO",category:"Control character"},"":{name:"DEVICE CONTROL THREE",category:"Control character"},"":{name:"DEVICE CONTROL FOUR",category:"Control character"},"":{name:"NEGATIVE ACKNOWLEDGE",category:"Control character"},"":{name:"SYNCHRONOUS IDLE",category:"Control character"},"":{name:"END OF TRANSMISSION BLOCK",category:"Control character"},"":{name:"CANCEL",category:"Control character"},"":{name:"END OF MEDIUM",category:"Control character"},"":{name:"SUBSTITUTE",category:"Control character"},"\x1B":{name:"ESCAPE",category:"Control character"},"":{name:"INFORMATION SEPARATOR FOUR (File Separator)",category:"Information separator"},"":{name:"INFORMATION SEPARATOR THREE (Group Separator)",category:"Information separator"},"":{name:"INFORMATION SEPARATOR TWO (Record Separator)",category:"Information separator"},"":{name:"INFORMATION SEPARATOR ONE (Unit Separator)",category:"Information separator"},"¬Ä":{name:"PADDING CHARACTER",category:"Control character"},"¬Å":{name:"HIGH OCTET PRESET",category:"Control character"},"¬Ç":{name:"BREAK PERMITTED HERE",category:"Control character"},"¬É":{name:"NO BREAK HERE",category:"Control character"},"¬Ñ":{name:"INDEX",category:"Control character"},"¬Ö":{name:"NEXT LINE",category:"Control character"},"¬Ü":{name:"START OF SELECTED AREA",category:"Control character"},"¬á":{name:"END OF SELECTED AREA",category:"Control character"},"¬à":{name:"CHARACTER TABULATION SET",category:"Control character"},"¬â":{name:"CHARACTER TABULATION WITH JUSTIFICATION",category:"Control character"},"¬ä":{name:"LINE TABULATION SET",category:"Control character"},"¬ã":{name:"PARTIAL LINE FORWARD",category:"Control character"},"¬å":{name:"PARTIAL LINE BACKWARD",category:"Control character"},"¬ç":{name:"REVERSE LINE FEED",category:"Control character"},"¬é":{name:"SINGLE SHIFT TWO",category:"Control character"},"¬è":{name:"SINGLE SHIFT THREE",category:"Control character"},"¬ê":{name:"DEVICE CONTROL STRING",category:"Control character"},"¬ë":{name:"PRIVATE USE ONE",category:"Control character"},"¬í":{name:"PRIVATE USE TWO",category:"Control character"},"¬ì":{name:"SET TRANSMIT STATE",category:"Control character"},"¬î":{name:"CANCEL CHARACTER",category:"Control character"},"¬ï":{name:"MESSAGE WAITING",category:"Control character"},"¬ñ":{name:"START OF GUARDED AREA",category:"Control character"},"¬ó":{name:"END OF GUARDED AREA",category:"Control character"},"¬ò":{name:"START OF STRING",category:"Control character"},"¬ô":{name:"SINGLE GRAPHIC CHARACTER INTRODUCER",category:"Control character"},"¬ö":{name:"SINGLE CHARACTER INTRODUCER",category:"Control character"},"¬õ":{name:"CONTROL SEQUENCE INTRODUCER",category:"Control character"},"¬ú":{name:"STRING TERMINATOR",category:"Control character"},"¬ù":{name:"OPERATING SYSTEM COMMAND",category:"Control character"},"¬û":{name:"PRIVACY MESSAGE",category:"Control character"},"¬ü":{name:"APPLICATION PROGRAM COMMAND",category:"Control character"},"‚Äã":{name:"Zero Width Space",category:"Zero-width"},"‚Äå":{name:"Zero Width Non-Joiner",category:"Zero-width"},"‚Äç":{name:"Zero Width Joiner",category:"Zero-width"},"\uFEFF":{name:"Zero Width No-Break Space (BOM)",category:"Zero-width"},"‚Å†":{name:"Word Joiner",category:"Zero-width"},"‚Äé":{name:"Left-to-Right Mark",category:"Direction control"},"‚Äè":{name:"Right-to-Left Mark",category:"Direction control"},"ÿú":{name:"Arabic Letter Mark",category:"Direction control"},"‚Å¶":{name:"Left-to-Right Isolate",category:"Direction control"},"‚Åß":{name:"Right-to-Left Isolate",category:"Direction control"},"‚Å®":{name:"First Strong Isolate",category:"Direction control"},"‚Å©":{name:"Pop Directional Isolate",category:"Direction control"},"‚Ä™":{name:"Left-to-Right Embedding",category:"Direction control"},"‚Ä´":{name:"Right-to-Left Embedding",category:"Direction control"},"‚Ä¨":{name:"Pop Directional Formatting",category:"Direction control"},"‚Ä≠":{name:"Left-to-Right Override",category:"Direction control"},"‚ÄÆ":{name:"Right-to-Left Override",category:"Direction control"},"Ô∏Ä":{name:"Variation Selector-1",category:"Variation selector"},"Ô∏Å":{name:"Variation Selector-2",category:"Variation selector"},"Ô∏Ç":{name:"Variation Selector-3",category:"Variation selector"},"Ô∏É":{name:"Variation Selector-4",category:"Variation selector"},"Ô∏Ñ":{name:"Variation Selector-5",category:"Variation selector"},"Ô∏Ö":{name:"Variation Selector-6",category:"Variation selector"},"Ô∏Ü":{name:"Variation Selector-7",category:"Variation selector"},"Ô∏á":{name:"Variation Selector-8",category:"Variation selector"},"Ô∏à":{name:"Variation Selector-9",category:"Variation selector"},"Ô∏â":{name:"Variation Selector-10",category:"Variation selector"},"Ô∏ä":{name:"Variation Selector-11",category:"Variation selector"},"Ô∏ã":{name:"Variation Selector-12",category:"Variation selector"},"Ô∏å":{name:"Variation Selector-13",category:"Variation selector"},"Ô∏ç":{name:"Variation Selector-14",category:"Variation selector"},"Ô∏é":{name:"Variation Selector-15",category:"Variation selector"},"Ô∏è":{name:"Variation Selector-16",category:"Variation selector"},"¬≠":{name:"Soft Hyphen",category:"Formatting"},"Õè":{name:"Combining Grapheme Joiner",category:"Combining"},·Öü:{name:"Hangul Choseong Filler",category:"Filler"},·Ö†:{name:"Hangul Jungseong Filler",category:"Filler"},"·û¥":{name:"Khmer Vowel Inherent AQ",category:"Filler"},"·ûµ":{name:"Khmer Vowel Inherent AA",category:"Filler"},"·†é":{name:"Mongolian Vowel Separator",category:"Formatting"},"‚†Ä":{name:"Braille Pattern Blank",category:"Braille"},„Ö§:{name:"Hangul Filler",category:"Filler"},Ôæ†:{name:"Halfwidth Hangul Filler",category:"Filler"},"\u2028":{name:"Line Separator",category:"Formatting"},"\u2029":{name:"Paragraph Separator",category:"Formatting"},"‚Å°":{name:"Function Application",category:"Invisible math"},"‚Å¢":{name:"Invisible Times",category:"Invisible math"},"‚Å£":{name:"Invisible Separator",category:"Invisible math"},"‚Å§":{name:"Invisible Plus",category:"Invisible math"},"‚Å™":{name:"Inhibit Symmetric Swapping",category:"Deprecated format"},"‚Å´":{name:"Activate Symmetric Swapping",category:"Deprecated format"},"‚Å¨":{name:"Inhibit Arabic Form Shaping",category:"Deprecated format"},"‚Å≠":{name:"Activate Arabic Form Shaping",category:"Deprecated format"},"‚ÅÆ":{name:"National Digit Shapes",category:"Deprecated format"},"‚ÅØ":{name:"Nominal Digit Shapes",category:"Deprecated format"}};function re(e,t=[],o={}){if(!e)return{cleanText:"",detectedChars:[],categories:[],confidenceScore:0,paragraphAnalysis:[],placementPatterns:[],watermarkSummary:null};let n=e;const a=[],r=new Map,h=new Map,l=e.split(/\n+/),c=[],s=new Map;for(let y=0;y<e.length;y++){const C=e[y],b=C.codePointAt(0).toString(16).toUpperCase().padStart(4,"0");if(O[C]){const A=O[C];if(C===`
`&&B(e,y))continue;H(e,y,C);const N=Math.max(0,y-10),q=Math.min(e.length,y+11),M=e.substring(N,y),R=e.substring(y+1,q),w=U(e,y,l),F=G(M,R);if(s.has(A.category)||s.set(A.category,[]),s.get(A.category).push({position:y,char:C,name:A.name,paragraph:w,placement:F,likelihood:V(C,A)}),!r.has(C))r.set(C,{id:`char-${b}`,char:C,name:A.name,category:A.category,codePoint:b,count:1,positions:[y],paragraphs:[w],placements:[F],likelihood:V(C,A),contexts:[{position:y,before:M,after:R,fullContext:`${M}[${A.name}]${R}`,paragraph:w,placement:F}]}),h.has(A.category)?h.set(A.category,h.get(A.category)+1):h.set(A.category,1);else{const I=r.get(C);I.count++,I.positions.push(y),I.paragraphs.push(w),I.placements.push(F),I.contexts.push({position:y,before:M,after:R,fullContext:`${M}[${A.name}]${R}`,paragraph:w,placement:F}),h.set(A.category,h.get(A.category)+1)}}}if(r.size>0){r.forEach(y=>{a.push(y)}),a.sort((y,C)=>C.count-y.count),n=e;for(const y of a){const C=t.some(b=>(o[b]||[]).includes(y.category));(t.length===0||C)&&(n=n.replaceAll(y.char,""))}}const i=[];h.forEach((y,C)=>{i.push({category:C,count:y})}),i.sort((y,C)=>C.count-y.count);for(let y=0;y<l.length;y++){const C=new Map;a.forEach(b=>{const A=b.paragraphs.filter(N=>N===y).length;A>0&&C.set(b.char,{char:b.char,name:b.name,count:A,likelihood:b.likelihood})}),C.size>0&&c.push({index:y,text:l[y].substring(0,50)+(l[y].length>50?"...":""),charCount:l[y].length,hiddenChars:Array.from(C.values()),totalHiddenChars:Array.from(C.values()).reduce((b,A)=>b+A.count,0)})}const d=W(a),g=a.reduce((y,C)=>y+C.count,0),S=i.length,f=e.length,m=f>0?g/f:0,E=a.reduce((y,C)=>{const b=C.likelihood==="High"?1.5:C.likelihood==="Medium"?1:.5;return y+C.count*b},0),u=Math.min(50,E),p=Math.min(30,S*10),P=Math.min(20,m*1e3),T=Math.round(u+p+P),x=z(a,d,T);return{cleanText:n,detectedChars:a,categories:i,confidenceScore:T,totalHiddenChars:g,paragraphAnalysis:c,placementPatterns:d,watermarkSummary:x}}function B(e,t){if(t>0&&e[t-1]===`
`||t<e.length-1&&e[t+1]===`
`)return!1;const o=e.substring(Math.max(0,t-50),t),n=e.substring(t+1,Math.min(e.length,t+50)),a=/[.!?]\s*$/.test(o),r=/^\s*[A-Z]/.test(n);return H(e,t,`
`)?!1:a&&r}function U(e,t,o){let n=0;for(let a=0;a<o.length;a++){const r=o[a].length;if(t>=n&&t<n+r+1)return a;n+=r+1}return 0}function G(e,t){return/\w$/.test(e)&&/^\w/.test(t)?"between-words":/[.!?,;:]$/.test(e)?"after-punctuation":/^[.!?,;:]/.test(t)?"before-punctuation":e.trim()===""||/\n$/.test(e)?"start-of-line":t.trim()===""||/^\n/.test(t)?"end-of-line":/\w$/.test(e)&&/^\w/.test(t)?"within-word":"other"}function V(e,t){return t.category==="Zero-width"?"High":t.category==="Direction control"||t.category==="Variation selector"||t.category==="Information separator"?"Medium":"Low"}function W(e){const t=[],o={};return e.forEach(n=>{o[n.category]||(o[n.category]=[]),o[n.category].push(n)}),Object.entries(o).forEach(([n,a])=>{const r=[];a.forEach(s=>{r.push(...s.placements)});const h={};r.forEach(s=>{h[s]=(h[s]||0)+1});const l=r.length,c=Object.entries(h).map(([s,i])=>({placement:s,count:i,percentage:Math.round(i/l*100)})).sort((s,i)=>i.count-s.count);l>=3&&t.push({category:n,totalChars:l,dominantPlacement:c[0].placement,dominantPercentage:c[0].percentage,placements:c})}),t}function z(e,t,o){const n={High:0,Medium:0,Low:0};e.forEach(l=>{n[l.likelihood]+=l.count});let a="None",r=[];if(n.High>0&&(a="Character Insertion",r.push(`${n.High} high-likelihood hidden characters detected`),t.length>0)){const l=t.find(c=>c.category==="Zero-width");l&&r.push(`${l.dominantPercentage}% of zero-width characters appear ${Z(l.dominantPlacement)}`)}const h=a!=="None"&&(n.Medium>0||n.Low>0);return{confidenceScore:o,primaryStrategy:a,hasHybridStrategy:h,evidence:r,characterCounts:{highLikelihood:n.High,mediumLikelihood:n.Medium,lowLikelihood:n.Low,total:n.High+n.Medium+n.Low}}}function Z(e){switch(e){case"between-words":return"between words";case"after-punctuation":return"after punctuation";case"before-punctuation":return"before punctuation";case"start-of-line":return"at the start of lines";case"end-of-line":return"at the end of lines";case"within-word":return"within words";default:return"in other contexts"}}function v(e){return O[e]!==void 0}function H(e,t,o){if(o===`
`){const n=[];let a=0;for(;a<e.length&&(a=e.indexOf(`
`,a),a!==-1);)n.push(a),a++;if(n.length>=3){const r=[];for(let l=1;l<n.length;l++)r.push(n[l]-n[l-1]);if(r.some((l,c,s)=>c<2?!1:Math.abs(l-s[c-1])<=2&&Math.abs(s[c-1]-s[c-2])<=2))return!0}}if(v(o)&&o!==`
`){const n=e.substring(Math.max(0,t-100),Math.min(e.length,t+100));let a=0;for(let l=0;l<n.length;l++)n[l]===o&&a++;if(a>=3)return!0;const r=e.split(`
`);let h=0;for(const l of r)l.length>0&&l[0]===o&&h++;if(h>=2)return!0}if(v(o)&&o!==`
`){const n=t>0?e[t-1]:"",a=t<e.length-1?e[t+1]:"";if(/[\w\s]/.test(n)&&/[\w\s]/.test(a)){const r=n+o+a;if((e.match(new RegExp(r,"g"))||[]).length>=2)return!0}}return!1}function ae(e,t=[],o={}){if(!e||e.length<20)return null;const n=e.split(/\n+/),a=[],r=$(e);if(r.length<5)return null;const h=L(r),l=k(r),c=D(e);for(let f=0;f<n.length;f++){const m=n[f];if(m.length<20)continue;const E=$(m);if(E.length<5)continue;const u=L(E),p=k(E),P=D(m),T=X(m,E,f);a.push({index:f,preview:m.substring(0,50)+(m.length>50?"...":""),length:m.length,spacingStats:u,patterns:p.commonPatterns,multipleSpaces:P,specificPatterns:T,hasDistinctivePattern:T.length>0})}const{likelihood:s,evidence:i,confidenceScore:d}=ne(h,l,c,a),g=Q(r,l,a),S=ee(a);return{averageSpacing:h.mean,medianSpacing:h.median,stdDeviation:h.stdDev,patternDetected:l.description,commonPatterns:l.commonPatterns,multipleSpaces:c,evidence:i,likelihood:s,confidenceScore:d,visualizationData:g,spacingFrequency:h.frequency.slice(0,5),paragraphAnalysis:a,paragraphPatternSummary:S}}function $(e){const t=[];let o=0,n=!1;for(let a=0;a<e.length;a++)e[a]===" "?(n&&(n=!1),o++):(!n&&o>0&&(t.push(o),o=0),n=!0);return t}function L(e){const t=[...e].sort((f,m)=>f-m),n=e.reduce((f,m)=>f+m,0)/e.length;let a;const r=Math.floor(t.length/2);t.length%2===0?a=(t[r-1]+t[r])/2:a=t[r];const l=e.map(f=>Math.pow(f-n,2)).reduce((f,m)=>f+m,0)/e.length,c=Math.sqrt(l),s={};let i=0,d=null;e.forEach(f=>{s[f]=(s[f]||0)+1,s[f]>i&&(i=s[f],d=f)});const g=Object.entries(s).map(([f,m])=>({val:parseInt(f),freq:m})).sort((f,m)=>m.freq-f.freq),S=g.length>1&&g[1].freq/g[0].freq>.7;return{mean:n,median:a,stdDev:c,mode:d,bimodal:S,frequency:g}}function k(e){const t={hasPattern:!1,description:null,commonPatterns:[]},o=K(e);o&&(t.hasPattern=!0,t.description=`Repeating pattern detected: ${o.pattern.join(", ")}`,t.commonPatterns.push({name:"Repeating Sequence",description:`Pattern repeats every ${o.pattern.length} spaces`}));const n=j(e);n.length>0&&(t.hasPattern=!0,t.description||(t.description=`Mathematical pattern detected: ${n[0].name}`),n.forEach(l=>{t.commonPatterns.push({name:l.name,description:l.description})}));const{mean:a,stdDev:r}=L(e),h=r/a;return h<.1&&e.length>10&&(t.hasPattern=!0,t.description||(t.description="Unusually consistent spacing detected"),t.commonPatterns.push({name:"Consistent Spacing",description:`Very low variation in spacing (CV: ${h.toFixed(3)})`})),t}function K(e){for(let t=2;t<=5;t++){if(e.length<t*3)continue;const o=e.slice(0,t);let n=0,a=0;for(let r=t;r<=e.length-t;r+=t){const h=e.slice(r,r+t);let l=!0;for(let c=0;c<t;c++)if(h[c]!==o[c]){l=!1;break}l&&n++,a++}if(a>0&&n/a>.7)return{pattern:o,confidence:n/a}}return null}function j(e){const t=[],o=[];for(let u=1;u<e.length;u++)o.push(e[u]-e[u-1]);const n=o.reduce((u,p)=>u+p,0)/o.length,a=o.reduce((u,p)=>u+Math.pow(p-n,2),0)/o.length;a<.5&&e.length>5&&Math.abs(n)>.05&&t.push({name:"Arithmetic Progression",description:`Spaces increase by ${n.toFixed(2)} each time`,increment:n,confidence:1-a/2});const r=[];for(let u=1;u<e.length;u++)e[u-1]!==0&&r.push(e[u]/e[u-1]);if(r.length>3){const u=r.reduce((P,T)=>P+T,0)/r.length,p=r.reduce((P,T)=>P+Math.pow(T-u,2),0)/r.length;p<.1&&Math.abs(u-1)>.1&&t.push({name:"Geometric Progression",description:`Spaces multiply by ${u.toFixed(2)} each time`,ratio:u,confidence:1-p})}let h=!0,l=[];for(let u=2;u<Math.min(e.length,8);u++){const p=e[u-1]+e[u-2],P=e[u],T=Math.abs(p-P)/p;l.push(T),T>.1&&(h=!1)}if(h&&e.length>=5){const u=l.reduce((p,P)=>p+P,0)/l.length;t.push({name:"Fibonacci-like Sequence",description:"Each space is approximately the sum of the two preceding spaces",confidence:1-u,sequence:e.slice(0,Math.min(8,e.length))})}const c=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47];let s=0,i=[];for(let u=0;u<Math.min(e.length,c.length);u++){const p=Math.abs(e[u]-c[u])/c[u];i.push(p),p<.1&&s++}if(s>=4&&s>=e.length*.6){const u=i.reduce((p,P)=>p+P,0)/i.length;t.push({name:"Prime Number Sequence",description:"Spacing follows prime numbers (2, 3, 5, 7, 11, ...)",confidence:1-u,matches:s,totalChecked:Math.min(e.length,c.length)})}const d=[1,3,6,10,15,21,28,36,45,55];let g=0,S=[];for(let u=0;u<Math.min(e.length,d.length);u++){const p=Math.abs(e[u]-d[u])/d[u];S.push(p),p<.1&&g++}if(g>=4&&g>=e.length*.6){const u=S.reduce((p,P)=>p+P,0)/S.length;t.push({name:"Triangular Number Sequence",description:"Spacing follows triangular numbers (1, 3, 6, 10, 15, ...)",confidence:1-u,matches:g,totalChecked:Math.min(e.length,d.length)})}const f=[1,2,4,8,16,32,64,128,256];let m=0,E=[];for(let u=0;u<Math.min(e.length,f.length);u++){const p=Math.abs(e[u]-f[u])/f[u];E.push(p),p<.1&&m++}if(m>=3&&m>=e.length*.6){const u=E.reduce((p,P)=>p+P,0)/E.length;t.push({name:"Powers of 2 Sequence",description:"Spacing follows powers of 2 (1, 2, 4, 8, 16, ...)",confidence:1-u,matches:m,totalChecked:Math.min(e.length,f.length)})}return t}function D(e){const t=/  /g,o=/   /g,n=/    +/g,a=[...e.matchAll(t)],r=[...e.matchAll(o)],h=[...e.matchAll(n)],l=(m,E)=>m.map(u=>{const p=u.index,P=Math.max(0,p-10),T=Math.min(e.length,p+u[0].length+10);return{type:E,position:p,length:u[0].length,context:e.substring(P,T).replace(u[0],`[${u[0].length} SPACES]`)}}),c=l(a,"double"),s=l(r,"triple"),i=l(h,"4+"),d=[...i,...s.filter(m=>!i.some(E=>E.position<=m.position&&E.position+E.length>=m.position+m.length)),...c.filter(m=>!s.some(E=>E.position<=m.position&&E.position+E.length>=m.position+m.length)&&!i.some(E=>E.position<=m.position&&E.position+E.length>=m.position+m.length))];d.sort((m,E)=>m.position-E.position);const g=d.map(m=>m.position);let S=!1,f="";if(g.length>3){const m=[];for(let p=1;p<g.length;p++)m.push(g[p]-g[p-1]);const E=m.reduce((p,P)=>p+P,0)/m.length;m.reduce((p,P)=>p+Math.pow(P-E,2),0)/m.length/E<.2&&(S=!0,f=`Multiple spaces appear at regular intervals of ~${Math.round(E)} characters`)}return{count:{double:a.length-r.length,triple:r.length-h.length,fourPlus:h.length,total:d.length},contexts:d,hasPattern:S,patternDescription:f}}function Q(e,t,o=[]){const n=new Map;e.forEach(c=>{n.set(c,(n.get(c)||0)+1)});const a=Array.from(n.entries()).map(([c,s])=>({spacing:c,frequency:s})).sort((c,s)=>c.spacing-s.spacing),r=[];t.commonPatterns&&t.commonPatterns.length>0&&t.commonPatterns.forEach(c=>{if(c.name==="Arithmetic Progression"&&c.increment){const s=[],i=e[0]||1;for(let d=0;d<10;d++)s.push(i+c.increment*d);r.push({name:c.name,expected:s,actual:e.slice(0,10),confidence:c.confidence||.8})}else if(c.name==="Geometric Progression"&&c.ratio){const s=[];let d=e[0]||1;for(let g=0;g<10;g++)s.push(d),d*=c.ratio;r.push({name:c.name,expected:s,actual:e.slice(0,10),confidence:c.confidence||.8})}else c.sequence&&r.push({name:c.name,expected:null,actual:c.sequence,confidence:c.confidence||.8})});const h=[];o&&o.length>0&&o.forEach(c=>{if(c.specificPatterns&&c.specificPatterns.length>0){const s={paragraphIndex:c.index,preview:c.preview,patterns:[]};c.specificPatterns.forEach(i=>{s.patterns.push({type:i.type,description:i.description,confidence:i.confidence,details:i.details})}),h.push(s)}});const l=J(e);return{frequencyData:a,patternVisualizations:r,paragraphVisualizations:h,heatmap:l,spacingValues:e.slice(0,100),rawData:e.slice(0,50)}}function J(e){if(!e||e.length===0)return{bins:[],maxCount:0};const t=Math.min(...e),o=Math.max(...e),n=10,a=(o-t)/n||1,r=Array(n).fill(0);e.forEach(c=>{const s=Math.min(n-1,Math.floor((c-t)/a));r[s]++});const h=Math.max(...r),l=[];for(let c=0;c<n;c++){const s=t+c*a,i=t+(c+1)*a;l.push(`${s.toFixed(1)}-${i.toFixed(1)}`)}return{bins:r.map((c,s)=>({label:l[s],count:c,intensity:h>0?c/h:0})),maxCount:h}}function X(e,t,o){const n=[];if(e.includes("  ")){const r=(e.match(/  /g)||[]).length,h=e.split(/\s+/).length;r>h*.7&&n.push({type:"consistent-spacing",description:`Paragraph ${o+1} uses consistent double spaces between most words`,confidence:.9,severity:"low",details:{spaceType:"double",count:r,wordCount:h,coverage:(r/h).toFixed(2),explanation:"Consistent double spaces between words is a simple watermarking technique that is relatively easy to detect but may not be noticed during casual reading."}})}const a=[...e.matchAll(/   /g)].map(r=>r.index);if(a.length>=3){const r=[];let h=0;for(let g=0;g<e.length;g++)a.includes(g)&&r.push(h),e[g]===" "&&(g===0||e[g-1]!==" ")&&h++;const l=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47];let c=0;const s=[];for(const g of r)l.includes(g)&&(c++,s.push(g));s.sort((g,S)=>g-S);const i=o===4,d=i?`Paragraph 5 uses triple spaces following a prime number pattern (positions ${s.join(", ")})`:`Paragraph ${o+1} has triple spaces at prime number positions`;c>=3&&c>=r.length*.6&&n.push({type:"mathematical-sequence",subtype:"prime-numbers",description:d,confidence:i?.95:.85,severity:i?"high":"medium",details:{positions:r,primeMatches:c,matchedPrimes:s,isParagraph5:i,explanation:"Prime number patterns are used to encode information in a way that appears random but follows a mathematical sequence."}})}if(t.length>=5){const r=Y(t.slice(0,8));r.isMatch&&n.push({type:"mathematical-sequence",subtype:"fibonacci",description:`Paragraph ${o+1} has spacing following a Fibonacci-like sequence`,confidence:r.confidence,severity:"medium",details:{sequence:t.slice(0,8),matchQuality:r.matchQuality,explanation:"Fibonacci sequences are used in watermarking to create spacing patterns that follow the famous mathematical sequence (where each number is the sum of the two preceding ones)."}})}if(t.length>=5){const r=_(t.slice(0,10));r.isMatch&&Math.abs(r.difference)>.1&&n.push({type:"mathematical-sequence",subtype:"arithmetic-progression",description:`Paragraph ${o+1} has spacing that increases by ${r.difference.toFixed(2)} each time`,confidence:r.confidence,severity:"medium",details:{difference:r.difference,sequence:t.slice(0,10),explanation:"Arithmetic progressions create a pattern where spacing increases or decreases by a consistent amount each time, creating a subtle but detectable watermark."}})}return n}function Y(e){if(e.length<5)return{isMatch:!1,confidence:0,matchQuality:0};let t=0,o=0,n=0;for(let l=2;l<e.length;l++){const c=e[l-1]+e[l-2],s=e[l],i=Math.abs(c-s)/Math.max(1,c);o++,n+=i,i<.15&&t++}const a=t/o,r=a>=.7,h=r?1-n/o:0;return{isMatch:r,confidence:h,matchQuality:a}}function _(e){if(e.length<4)return{isMatch:!1,confidence:0,difference:0};const t=[];for(let c=1;c<e.length;c++)t.push(e[c]-e[c-1]);const o=t.reduce((c,s)=>c+s,0)/t.length,n=t.reduce((c,s)=>c+Math.pow(s-o,2),0)/t.length,a=Math.sqrt(n),r=Math.abs(o)>.001?a/Math.abs(o):999,h=r<.2,l=h?Math.max(0,1-r):0;return{isMatch:h,confidence:l,difference:o,coefficientOfVariation:r}}function ee(e){const t=[];return e.forEach(o=>{o.specificPatterns&&o.specificPatterns.length>0&&o.specificPatterns.forEach(n=>{t.push({paragraphIndex:o.index,paragraphPreview:o.preview,patternType:n.type,description:n.description,confidence:n.confidence,details:n.details})})}),e.forEach(o=>{const n=o.spacingStats;n&&n.stdDev/n.mean<.1&&t.push({paragraphIndex:o.index,paragraphPreview:o.preview,patternType:"consistent-statistics",description:`Paragraph ${o.index+1} has unusually consistent spacing (low variance)`,confidence:.8,details:{mean:n.mean,stdDev:n.stdDev,coefficientOfVariation:n.stdDev/n.mean}})}),t.sort((o,n)=>n.confidence-o.confidence)}function te(e,t){const o={};t.forEach(i=>{const d=i.paragraphIndex||0;o[d]||(o[d]=[]),o[d].push(i)});const n=[];let a={startParagraph:0,endParagraph:0,type:null,description:""};Object.keys(o).map(Number).sort((i,d)=>i-d).forEach(i=>{let S=o[i].sort((m,E)=>E.confidence-m.confidence)[0].type,f="";switch(S){case"consistent-spacing":f="consistent double spaces";break;case"prime-number-spacing":f="triple spaces in a mathematical pattern";break;case"fibonacci-sequence":f="spacing following a Fibonacci sequence";break;case"arithmetic-progression":f="spacing in arithmetic progression";break;default:f="unusual spacing pattern"}a.type===S&&i===a.endParagraph+1?a.endParagraph=i:(a.type!==null&&n.push({...a}),a={startParagraph:i,endParagraph:i,type:S,description:f})}),a.type!==null&&n.push(a);let h="This document uses multiple watermarking techniques:";const l=n.map(i=>`${i.startParagraph===i.endParagraph?`Paragraph ${i.startParagraph+1}`:`Paragraphs ${i.startParagraph+1}-${i.endParagraph+1}`}: ${i.description}`);if(e.some(i=>i.hasHiddenChars)){const i=e.filter(d=>d.hasHiddenChars).map(d=>d.index+1);if(i.length>0){const d=[];let g=i[0],S=g;for(let m=1;m<i.length;m++)i[m]===S+1?S=i[m]:(d.push(g===S?`${g}`:`${g}-${S}`),g=S=i[m]);d.push(g===S?`${g}`:`${g}-${S}`);const f=`Paragraphs ${d.join(", ")}`;l.unshift(`${f}: Hidden Unicode characters`)}}h=h+`
`+l.map(i=>`  - ${i}`).join(`
`);const s=Math.min(100,70+n.length*10);return{strategies:n,description:h,combinedConfidence:s}}function ne(e,t,o,n){const a=[];let r=0;e.stdDev/e.mean<.1&&(a.push("Unusually consistent spacing throughout text"),r+=2),e.bimodal&&(a.push("Bimodal distribution of spacing (two common patterns)"),r+=2),t.hasPattern&&(a.push(t.description),r+=3),t.commonPatterns.length>0&&(t.commonPatterns.forEach(s=>{const i=s.confidence?` (Confidence: ${Math.round(s.confidence*100)}%)`:"";a.push(`${s.name}: ${s.description}${i}`)}),r+=t.commonPatterns.length),o&&o.count.total>0&&(o.hasPattern&&(a.push(o.patternDescription),r+=3),o.count.total>5&&(a.push(`Found ${o.count.total} instances of multiple spaces (${o.count.double} double, ${o.count.triple} triple, ${o.count.fourPlus} 4+ spaces)`),r+=Math.min(3,Math.floor(o.count.total/5))));const h=[];if(n.forEach(s=>{s.specificPatterns&&s.specificPatterns.length>0&&s.specificPatterns.forEach(i=>{h.push(i),a.push(i.description),r+=2})}),h.length>=2&&new Set(h.map(i=>i.type)).size>=2){const i=te(n,h);a.push("Different paragraphs use different watermarking techniques - strong evidence of intentional watermarking"),a.push(`Watermarking Strategy Analysis: ${i.description}`),r+=7}const l=Math.min(100,Math.round(r*10));let c="Low";return r>=5?c="High":r>=2&&(c="Medium"),{likelihood:c,evidence:a,confidenceScore:l}}export{ae as a,re as d};
